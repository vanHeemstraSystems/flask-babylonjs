# 300 - Step 02 - Setting up an example Database and Model

In this step, you’ll set up your Flask application and a Flask-SQLAlchemy database with a model representing a users table where you’ll store your app’s users.

In your ```flask_app/app``` directory, open a file called ```__init__.py```. This will hold your Flask application’s app core code:


```
#!/usr/bin/env python
from flask import Flask
from config import Config
from app.extensions import db, bcrypt, login_manager, socketio
...
def create_app(config_class=Config):
    app = Flask(__name__, static_url_path='/static')
    app.config.from_object(config_class)

    # Initialize Flask extensions here
    db.init_app(app)

    from app.routes.user_routes import user_bp
    app.register_blueprint(user_bp, url_prefix='/users')

    return app
```
flask_app/app/\_\_init__.py


You import the ```Flask``` class and ```SQLAlchemy``` from the ```flask``` and ```flask_sqlalchemy``` modules (from ```app.extensions```) here. Then you create a Flask app instance called ```app```.

Next, you set the SQLite database URI in the app configuration (here ```flask_app/config.py```); this specifies the database file name as ```app.db```. This database file will be created in a new folder inside called ````instance````, which will be generated by Flask in the ```flask_app``` main directory.

In ```flask_app/app/extensions.py``` with ```db = SQLAlchemy()```, you create an SQLAlchemy instance, ```db```. 

By passing the Flask ```app``` as an argument, you initiate the ```db``` in ```flask_app/app/__init__.py``` with ```db.init_app(app)```.

Next, you create a ```User``` class that inherits from ```db.Model```, representing a database table named ‘users’. In the table, you define an ```id``` column for the user ID and a ```username``` column for the username, amongst other columns.

```
#!/usr/bin/env python
from app.extensions import db, bcrypt, login_manager
from flask_login import UserMixin

@login_manager.user_loader
def load_user(user_id):
    return User.query.get(int(user_id))

class User(db.Model, UserMixin):
    __tablename__ = 'user'
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(100), nullable=False, unique=True)
    email = db.Column(db.String(120), nullable=False, unique=True)
    password_hash = db.Column(db.String(128), nullable=False)
    created_at = db.Column(db.DateTime, nullable=False, default=db.func.current_timestamp())

    def __repr__(self):
        return f'<User {self.username}>'

    def set_password(self, password):
        self.password_hash = bcrypt.generate_password_hash(password).decode('utf-8')

    def check_password(self, password):
        return bcrypt.check_password_hash(self.password_hash, password) 
```
flask_app/app/models/user.py

The special [repr](https://docs.python.org/3/reference/datamodel.html#object.__repr__) function allows you to give each object a string representation to recognize it for debugging purposes.

Finally in ```flask_app/app/routes/user_routes.py```, you create a route ('/users') that returns a simple HTML response listing all users when the URL is accessed.


```
#!/usr/bin/env python
from flask import Blueprint, render_template, request, redirect, url_for, flash
from app.models.user import User
from app.forms.user_form import UserForm
from app.extensions import db

user_bp = Blueprint('user', __name__)

@user_bp.route('/users')
def list_users():
   users = User.query.all()
   return render_template('users.html', users=users)
```
flask_app/app/routes/user_routes.py

Execute the following command to test that the application is set up correctly. This runs the app Flask application in a development server with debugging activated:

```
(.venv) flask_app $ flask_run 
```

Once you run this command, you will receive the following output:

```
 * Serving Flask app 'app'
 * Debug mode: on
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on http://127.0.0.1:5000
Press CTRL+C to quit
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 155-093-934
```

With the development server running, visit the following URL using your browser:

```
http://127.0.0.1:5000/
```

You’ll get an index page (here: ```main.index```). This confirms that the application is set up properly. 

You can now move into the next step and add Flask-Migrate to your app.